<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Hybrid AI Agents: Combining LLMs with Symbolic Reasoning - Engineering Notes</title><meta name="viewport" content="width=device-width, initial-scale=1">
	
  <meta itemprop="name" content="Hybrid AI Agents: Combining LLMs with Symbolic Reasoning">
  <meta itemprop="description" content="Build more reliable AI agents by combining the flexibility of LLMs with the precision of symbolic reasoning systems.">
  <meta itemprop="datePublished" content="2026-01-03T00:00:00+00:00">
  <meta itemprop="dateModified" content="2026-01-03T00:00:00+00:00">
  <meta itemprop="wordCount" content="1807">
  <meta itemprop="keywords" content="Ai,Symbolic AI,Hybrid Systems,Python,Tutorial"><meta property="og:url" content="https://notes.muthu.co/2026/01/hybrid-ai-agents-combining-llms-with-symbolic-reasoning/">
  <meta property="og:site_name" content="Engineering Notes">
  <meta property="og:title" content="Hybrid AI Agents: Combining LLMs with Symbolic Reasoning">
  <meta property="og:description" content="Build more reliable AI agents by combining the flexibility of LLMs with the precision of symbolic reasoning systems.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-01-03T00:00:00+00:00">
    <meta property="article:modified_time" content="2026-01-03T00:00:00+00:00">
    <meta property="article:tag" content="Ai">
    <meta property="article:tag" content="Symbolic AI">
    <meta property="article:tag" content="Hybrid Systems">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Tutorial">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Hybrid AI Agents: Combining LLMs with Symbolic Reasoning">
  <meta name="twitter:description" content="Build more reliable AI agents by combining the flexibility of LLMs with the precision of symbolic reasoning systems.">
<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" media="screen" href="https://notes.muthu.co/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://notes.muthu.co/css/main.css" />
	<link rel="stylesheet" type="text/css" media="print" href="https://notes.muthu.co/css/print.css" />

	<link id="dark-scheme" rel="stylesheet" type="text/css" href="https://notes.muthu.co/css/dark.css" /><script src="https://notes.muthu.co/js/feather.min.js"></script>
	
	<script src="https://notes.muthu.co/js/main.js"></script>
</head>


<body>


	
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://notes.muthu.co/">
				<img src="/avatar.jpeg" alt="Engineering Notes" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://notes.muthu.co/">Engineering Notes</a></h1>
	<div class="site-description"><p>Thoughts and Ideas on AI by Muthukrishnan</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/muthuspark/" title="Github"><i data-feather="github"></i></a></li><li><a href="https://linkedin.com/in/krimuthu/" title="LinkedIn"><i data-feather="linkedin"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/resume">Resume</a>
			</li>
			
			<li>
				<a href="/tags">Tags &amp; Stats</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
    <div class="post-header">
    <div class="matter">
        <h1 class="title">Hybrid AI Agents: Combining LLMs with Symbolic Reasoning</h1>
        
        <div class="date">
            <span class="day">03</span>
            <span class="rest">Jan 2026</span>
        </div>
        
    </div>
</div>


    
    
    <p>LLMs are remarkably flexible but notoriously unreliable for precise reasoning. They hallucinate, make arithmetic errors, and struggle with complex logic. Symbolic systems—rule engines, constraint solvers, knowledge graphs—are precise but rigid.</p>
<p>The solution? Combine them. Hybrid AI agents use LLMs for natural language understanding and high-level reasoning, while delegating precise tasks to symbolic systems. This is emerging as a key pattern in production AI systems.</p>
<h2 id="why-hybrid">Why Hybrid?</h2>
<p>Consider a tax preparation agent. An LLM can:</p>
<ul>
<li>Understand user questions in natural language</li>
<li>Explain tax concepts clearly</li>
<li>Guide users through forms</li>
</ul>
<p>But it shouldn&rsquo;t:</p>
<ul>
<li>Calculate tax liability (arithmetic errors)</li>
<li>Apply deduction rules (might miss edge cases)</li>
<li>Determine filing status (complex boolean logic)</li>
</ul>
<p>A hybrid approach uses the LLM as the &ldquo;brain&rdquo; and symbolic systems as precise &ldquo;calculators.&rdquo;</p>
<pre class="mermaid">graph LR
    A[User Query] --&gt; B[LLM Controller]
    B --&gt; C{Task Type}
    C --&gt;|Understanding| B
    C --&gt;|Calculation| D[Symbolic Calculator]
    C --&gt;|Rule Checking| E[Rule Engine]
    C --&gt;|Data Query| F[Knowledge Graph]
    D --&gt; B
    E --&gt; B
    F --&gt; B
    B --&gt; G[Response]
  </pre>

<h2 id="building-a-hybrid-agent">Building a Hybrid Agent</h2>
<p>We&rsquo;ll create an agent that helps with loan eligibility decisions. The LLM handles conversation; a rule engine handles eligibility logic.</p>
<h3 id="step-1-define-the-rules">Step 1: Define the Rules</h3>
<p>First, encode eligibility rules in a structured format:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># rules.py</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">dataclasses</span> <span style="color:#cf222e">import</span> dataclass
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">enum</span> <span style="color:#cf222e">import</span> Enum
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">typing</span> <span style="color:#cf222e">import</span> Callable
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">class</span> <span style="color:#1f2328">RuleResult</span><span style="color:#1f2328">(</span>Enum<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    PASS <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;pass&#34;</span>
</span></span><span style="display:flex;"><span>    FAIL <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;fail&#34;</span>
</span></span><span style="display:flex;"><span>    NEEDS_INFO <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;needs_info&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">@dataclass</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">class</span> <span style="color:#1f2328">Rule</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    name<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span>
</span></span><span style="display:flex;"><span>    description<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span>
</span></span><span style="display:flex;"><span>    check<span style="color:#1f2328">:</span> Callable<span style="color:#1f2328">[[</span><span style="color:#6639ba">dict</span><span style="color:#1f2328">],</span> RuleResult<span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    failure_reason<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Loan eligibility rules</span>
</span></span><span style="display:flex;"><span>LOAN_RULES <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>    Rule<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        name<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;minimum_age&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        description<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Applicant must be at least 18 years old&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        check<span style="color:#0550ae">=</span><span style="color:#cf222e">lambda</span> data<span style="color:#1f2328">:</span> RuleResult<span style="color:#0550ae">.</span>PASS <span style="color:#cf222e">if</span> data<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;age&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">&gt;=</span> <span style="color:#0550ae">18</span> <span style="color:#cf222e">else</span> RuleResult<span style="color:#0550ae">.</span>FAIL<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        failure_reason<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Applicant must be 18 or older&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>    Rule<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        name<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;minimum_income&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        description<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Annual income must be at least $30,000&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        check<span style="color:#0550ae">=</span><span style="color:#cf222e">lambda</span> data<span style="color:#1f2328">:</span> RuleResult<span style="color:#0550ae">.</span>PASS <span style="color:#cf222e">if</span> data<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;annual_income&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">&gt;=</span> <span style="color:#0550ae">30000</span> <span style="color:#cf222e">else</span> RuleResult<span style="color:#0550ae">.</span>FAIL<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        failure_reason<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Annual income below $30,000 minimum&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>    Rule<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        name<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;debt_to_income&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        description<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Debt-to-income ratio must be below 43%&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        check<span style="color:#0550ae">=</span><span style="color:#cf222e">lambda</span> data<span style="color:#1f2328">:</span> <span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            RuleResult<span style="color:#0550ae">.</span>PASS
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">if</span> data<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;annual_income&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">&gt;</span> <span style="color:#0550ae">0</span> <span style="color:#0550ae">and</span>
</span></span><span style="display:flex;"><span>               <span style="color:#1f2328">(</span>data<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;monthly_debt&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">*</span> <span style="color:#0550ae">12</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">/</span> data<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;annual_income&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">1</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">&lt;</span> <span style="color:#0550ae">0.43</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">else</span> RuleResult<span style="color:#0550ae">.</span>FAIL
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>        failure_reason<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Debt-to-income ratio exceeds 43%&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>    Rule<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        name<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;credit_score&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        description<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Credit score must be at least 620&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        check<span style="color:#0550ae">=</span><span style="color:#cf222e">lambda</span> data<span style="color:#1f2328">:</span> RuleResult<span style="color:#0550ae">.</span>PASS <span style="color:#cf222e">if</span> data<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;credit_score&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">&gt;=</span> <span style="color:#0550ae">620</span> <span style="color:#cf222e">else</span> RuleResult<span style="color:#0550ae">.</span>FAIL<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        failure_reason<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Credit score below 620 minimum&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>    Rule<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        name<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;employment_status&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        description<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Must be employed or have verified income source&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        check<span style="color:#0550ae">=</span><span style="color:#cf222e">lambda</span> data<span style="color:#1f2328">:</span> <span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            RuleResult<span style="color:#0550ae">.</span>PASS
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">if</span> data<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;employment_status&#34;</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">in</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;employed&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;self_employed&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;retired&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">else</span> RuleResult<span style="color:#0550ae">.</span>FAIL
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>        failure_reason<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;No verified employment or income source&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">]</span>
</span></span></code></pre></div><h3 id="step-2-build-the-rule-engine">Step 2: Build the Rule Engine</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># rule_engine.py</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">rules</span> <span style="color:#cf222e">import</span> LOAN_RULES<span style="color:#1f2328">,</span> RuleResult
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">class</span> <span style="color:#1f2328">LoanRuleEngine</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">__init__</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>rules <span style="color:#0550ae">=</span> LOAN_RULES
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">evaluate</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> applicant_data<span style="color:#1f2328">:</span> <span style="color:#6639ba">dict</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">dict</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;&#34;&#34;Evaluate all rules against applicant data.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        results <span style="color:#0550ae">=</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;eligible&#34;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">True</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;passed_rules&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[],</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;failed_rules&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[],</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;missing_data&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">for</span> rule <span style="color:#0550ae">in</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>rules<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                result <span style="color:#0550ae">=</span> rule<span style="color:#0550ae">.</span>check<span style="color:#1f2328">(</span>applicant_data<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#cf222e">if</span> result <span style="color:#0550ae">==</span> RuleResult<span style="color:#0550ae">.</span>PASS<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                    results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;passed_rules&#34;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>append<span style="color:#1f2328">(</span>rule<span style="color:#0550ae">.</span>name<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#cf222e">elif</span> result <span style="color:#0550ae">==</span> RuleResult<span style="color:#0550ae">.</span>FAIL<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                    results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;eligible&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> <span style="color:#cf222e">False</span>
</span></span><span style="display:flex;"><span>                    results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;failed_rules&#34;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>append<span style="color:#1f2328">({</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#0a3069">&#34;rule&#34;</span><span style="color:#1f2328">:</span> rule<span style="color:#0550ae">.</span>name<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#0a3069">&#34;reason&#34;</span><span style="color:#1f2328">:</span> rule<span style="color:#0550ae">.</span>failure_reason
</span></span><span style="display:flex;"><span>                    <span style="color:#1f2328">})</span>
</span></span><span style="display:flex;"><span>                <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>  <span style="color:#57606a"># NEEDS_INFO</span>
</span></span><span style="display:flex;"><span>                    results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;missing_data&#34;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>append<span style="color:#1f2328">(</span>rule<span style="color:#0550ae">.</span>name<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">except</span> KeyError <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;missing_data&#34;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>append<span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">{</span>rule<span style="color:#0550ae">.</span>name<span style="color:#0a3069">}</span><span style="color:#0a3069">: missing </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> results
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">get_required_fields</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">list</span><span style="color:#1f2328">[</span><span style="color:#6639ba">str</span><span style="color:#1f2328">]:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;&#34;&#34;Return list of data fields needed for evaluation.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;age&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;annual_income&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;monthly_debt&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;credit_score&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;employment_status&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">explain_rules</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;&#34;&#34;Generate human-readable rule explanations.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        explanations <span style="color:#0550ae">=</span> <span style="color:#1f2328">[]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">for</span> rule <span style="color:#0550ae">in</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>rules<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            explanations<span style="color:#0550ae">.</span>append<span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;- </span><span style="color:#0a3069">{</span>rule<span style="color:#0550ae">.</span>description<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">&#34;</span><span style="color:#0550ae">.</span>join<span style="color:#1f2328">(</span>explanations<span style="color:#1f2328">)</span>
</span></span></code></pre></div><h3 id="step-3-create-tool-functions">Step 3: Create Tool Functions</h3>
<p>Expose the rule engine to the LLM as tools:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># tools.py</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">rule_engine</span> <span style="color:#cf222e">import</span> LoanRuleEngine
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>engine <span style="color:#0550ae">=</span> LoanRuleEngine<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">check_loan_eligibility</span><span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    age<span style="color:#1f2328">:</span> <span style="color:#6639ba">int</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    annual_income<span style="color:#1f2328">:</span> <span style="color:#6639ba">float</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    monthly_debt<span style="color:#1f2328">:</span> <span style="color:#6639ba">float</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    credit_score<span style="color:#1f2328">:</span> <span style="color:#6639ba">int</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    employment_status<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Check if an applicant is eligible for a loan based on our criteria.
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        age: Applicant&#39;s age in years
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        annual_income: Total annual income in dollars
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        monthly_debt: Total monthly debt payments in dollars
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        credit_score: Credit score (300-850)
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        employment_status: One of &#39;employed&#39;, &#39;self_employed&#39;, &#39;retired&#39;, &#39;unemployed&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    data <span style="color:#0550ae">=</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;age&#34;</span><span style="color:#1f2328">:</span> age<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;annual_income&#34;</span><span style="color:#1f2328">:</span> annual_income<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;monthly_debt&#34;</span><span style="color:#1f2328">:</span> monthly_debt<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;credit_score&#34;</span><span style="color:#1f2328">:</span> credit_score<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;employment_status&#34;</span><span style="color:#1f2328">:</span> employment_status
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    result <span style="color:#0550ae">=</span> engine<span style="color:#0550ae">.</span>evaluate<span style="color:#1f2328">(</span>data<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> result<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;eligible&#34;</span><span style="color:#1f2328">]:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;ELIGIBLE: Applicant passes all </span><span style="color:#0a3069">{</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>result<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;passed_rules&#39;</span><span style="color:#1f2328">])</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> eligibility criteria.&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        failures <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">&#34;</span><span style="color:#0550ae">.</span>join<span style="color:#1f2328">([</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;- </span><span style="color:#0a3069">{</span>f<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;reason&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span> <span style="color:#cf222e">for</span> f <span style="color:#0550ae">in</span> result<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;failed_rules&#34;</span><span style="color:#1f2328">]])</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;NOT ELIGIBLE:</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">{</span>failures<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">get_eligibility_requirements</span><span style="color:#1f2328">()</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Get the list of loan eligibility requirements.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Loan Eligibility Requirements:</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">{</span>engine<span style="color:#0550ae">.</span>explain_rules<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">calculate_debt_to_income</span><span style="color:#1f2328">(</span>annual_income<span style="color:#1f2328">:</span> <span style="color:#6639ba">float</span><span style="color:#1f2328">,</span> monthly_debt<span style="color:#1f2328">:</span> <span style="color:#6639ba">float</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Calculate debt-to-income ratio.
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        annual_income: Total annual income in dollars
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        monthly_debt: Total monthly debt payments in dollars
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> annual_income <span style="color:#0550ae">&lt;=</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#0a3069">&#34;Error: Annual income must be greater than zero&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dti <span style="color:#0550ae">=</span> <span style="color:#1f2328">(</span>monthly_debt <span style="color:#0550ae">*</span> <span style="color:#0550ae">12</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">/</span> annual_income
</span></span><span style="display:flex;"><span>    percentage <span style="color:#0550ae">=</span> dti <span style="color:#0550ae">*</span> <span style="color:#0550ae">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    status <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;acceptable&#34;</span> <span style="color:#cf222e">if</span> dti <span style="color:#0550ae">&lt;</span> <span style="color:#0550ae">0.43</span> <span style="color:#cf222e">else</span> <span style="color:#0a3069">&#34;too high&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Debt-to-income ratio: </span><span style="color:#0a3069">{</span>percentage<span style="color:#0a3069">:</span><span style="color:#0a3069">.1f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">% (</span><span style="color:#0a3069">{</span>status<span style="color:#0a3069">}</span><span style="color:#0a3069">). Maximum allowed: 43%&#34;</span>
</span></span></code></pre></div><h3 id="step-4-wire-up-the-agent">Step 4: Wire Up the Agent</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># agent.py</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">openai</span> <span style="color:#cf222e">import</span> OpenAI
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">tools</span> <span style="color:#cf222e">import</span> check_loan_eligibility<span style="color:#1f2328">,</span> get_eligibility_requirements<span style="color:#1f2328">,</span> calculate_debt_to_income
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">json</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>client <span style="color:#0550ae">=</span> OpenAI<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TOOLS <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;function&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;function&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;name&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;check_loan_eligibility&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;description&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;Check if an applicant is eligible for a loan based on our criteria&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;parameters&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;object&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;properties&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#0a3069">&#34;age&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;integer&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;description&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;Applicant&#39;s age in years&#34;</span><span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#0a3069">&#34;annual_income&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;number&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;description&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;Total annual income in dollars&#34;</span><span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#0a3069">&#34;monthly_debt&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;number&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;description&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;Total monthly debt payments in dollars&#34;</span><span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#0a3069">&#34;credit_score&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;integer&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;description&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;Credit score (300-850)&#34;</span><span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#0a3069">&#34;employment_status&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;string&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;enum&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;employed&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;self_employed&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;retired&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;unemployed&#34;</span><span style="color:#1f2328">]}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;required&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;age&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;annual_income&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;monthly_debt&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;credit_score&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;employment_status&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;function&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;function&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;name&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;get_eligibility_requirements&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;description&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;Get the list of loan eligibility requirements&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;parameters&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;object&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;properties&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;function&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;function&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;name&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;calculate_debt_to_income&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;description&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;Calculate debt-to-income ratio&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;parameters&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;object&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;properties&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#0a3069">&#34;annual_income&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;number&#34;</span><span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#0a3069">&#34;monthly_debt&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;number&#34;</span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;required&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;annual_income&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;monthly_debt&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SYSTEM_PROMPT <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;&#34;&#34;You are a helpful loan eligibility assistant.
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">Your job is to:
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">1. Help users understand loan eligibility requirements
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">2. Collect their information (age, income, debt, credit score, employment)
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">3. Check their eligibility using the check_loan_eligibility tool
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">4. Explain the results clearly
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">Important:
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">- ALWAYS use the tools for eligibility checks and calculations
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">- NEVER calculate or guess eligibility yourself
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">- Ask for information one or two questions at a time
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">- Be encouraging but honest about results
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TOOL_FUNCTIONS <span style="color:#0550ae">=</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;check_loan_eligibility&#34;</span><span style="color:#1f2328">:</span> check_loan_eligibility<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;get_eligibility_requirements&#34;</span><span style="color:#1f2328">:</span> get_eligibility_requirements<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;calculate_debt_to_income&#34;</span><span style="color:#1f2328">:</span> calculate_debt_to_income
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">run_agent</span><span style="color:#1f2328">(</span>messages<span style="color:#1f2328">:</span> <span style="color:#6639ba">list</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Run the agent and return response.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    response <span style="color:#0550ae">=</span> client<span style="color:#0550ae">.</span>chat<span style="color:#0550ae">.</span>completions<span style="color:#0550ae">.</span>create<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        model<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;gpt-4o-mini&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        messages<span style="color:#0550ae">=</span><span style="color:#1f2328">[{</span><span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;system&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> SYSTEM_PROMPT<span style="color:#1f2328">}]</span> <span style="color:#0550ae">+</span> messages<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        tools<span style="color:#0550ae">=</span>TOOLS
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    message <span style="color:#0550ae">=</span> response<span style="color:#0550ae">.</span>choices<span style="color:#1f2328">[</span><span style="color:#0550ae">0</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>message
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Handle tool calls</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> message<span style="color:#0550ae">.</span>tool_calls<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Execute each tool</span>
</span></span><span style="display:flex;"><span>        tool_results <span style="color:#0550ae">=</span> <span style="color:#1f2328">[]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">for</span> tool_call <span style="color:#0550ae">in</span> message<span style="color:#0550ae">.</span>tool_calls<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            func_name <span style="color:#0550ae">=</span> tool_call<span style="color:#0550ae">.</span>function<span style="color:#0550ae">.</span>name
</span></span><span style="display:flex;"><span>            func_args <span style="color:#0550ae">=</span> json<span style="color:#0550ae">.</span>loads<span style="color:#1f2328">(</span>tool_call<span style="color:#0550ae">.</span>function<span style="color:#0550ae">.</span>arguments<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            result <span style="color:#0550ae">=</span> TOOL_FUNCTIONS<span style="color:#1f2328">[</span>func_name<span style="color:#1f2328">](</span><span style="color:#0550ae">**</span>func_args<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            tool_results<span style="color:#0550ae">.</span>append<span style="color:#1f2328">({</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;tool&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;tool_call_id&#34;</span><span style="color:#1f2328">:</span> tool_call<span style="color:#0550ae">.</span>id<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> result
</span></span><span style="display:flex;"><span>            <span style="color:#1f2328">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Get final response with tool results</span>
</span></span><span style="display:flex;"><span>        messages<span style="color:#0550ae">.</span>append<span style="color:#1f2328">({</span><span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;assistant&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> message<span style="color:#0550ae">.</span>content<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;tool_calls&#34;</span><span style="color:#1f2328">:</span> message<span style="color:#0550ae">.</span>tool_calls<span style="color:#1f2328">})</span>
</span></span><span style="display:flex;"><span>        messages<span style="color:#0550ae">.</span>extend<span style="color:#1f2328">(</span>tool_results<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        final_response <span style="color:#0550ae">=</span> client<span style="color:#0550ae">.</span>chat<span style="color:#0550ae">.</span>completions<span style="color:#0550ae">.</span>create<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            model<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;gpt-4o-mini&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            messages<span style="color:#0550ae">=</span><span style="color:#1f2328">[{</span><span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;system&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> SYSTEM_PROMPT<span style="color:#1f2328">}]</span> <span style="color:#0550ae">+</span> messages
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> final_response<span style="color:#0550ae">.</span>choices<span style="color:#1f2328">[</span><span style="color:#0550ae">0</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>message<span style="color:#0550ae">.</span>content
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> message<span style="color:#0550ae">.</span>content
</span></span></code></pre></div><h3 id="example-conversation">Example Conversation</h3>
<pre tabindex="0"><code>User: Hi, I want to check if I can get a loan

Agent: I&#39;d be happy to help you check your loan eligibility! Let me ask you
a few questions. First, could you tell me your age and employment status?

User: I&#39;m 32 and I work full-time as an engineer

Agent: Great! Now I need some financial information. What&#39;s your annual
income, and approximately how much do you pay monthly towards debts
(like car loans, credit cards, student loans)?

User: I make about $95,000 a year. My monthly debts are around $1,800

Agent: Thanks! One last question - what&#39;s your credit score? If you don&#39;t
know the exact number, an estimate is fine.

User: It&#39;s around 720

Agent: Let me check your eligibility...

[Calls check_loan_eligibility tool with collected data]

Great news! Based on the information you provided, you ARE ELIGIBLE
for a loan. Here&#39;s the summary:

✓ Age: 32 (minimum 18)
✓ Annual income: $95,000 (minimum $30,000)
✓ Debt-to-income ratio: 22.7% (maximum 43%)
✓ Credit score: 720 (minimum 620)
✓ Employment status: employed ✓

Your debt-to-income ratio is healthy at 22.7%, well below the 43% maximum.
Would you like me to explain any of these criteria in more detail?
</code></pre><h2 id="benefits-of-this-approach">Benefits of This Approach</h2>
<h3 id="1-deterministic-decisions">1. Deterministic Decisions</h3>
<p>The rule engine always applies the same rules the same way. No hallucination.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># This will ALWAYS return the same result for the same input</span>
</span></span><span style="display:flex;"><span>result <span style="color:#0550ae">=</span> engine<span style="color:#0550ae">.</span>evaluate<span style="color:#1f2328">({</span><span style="color:#0a3069">&#34;age&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0550ae">25</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;credit_score&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0550ae">700</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">...</span><span style="color:#1f2328">})</span>
</span></span></code></pre></div><h3 id="2-auditability">2. Auditability</h3>
<p>You can trace exactly which rules passed or failed:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;eligible&#34;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">False</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;failed_rules&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;rule&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;credit_score&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;reason&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;Credit score below 620 minimum&#34;</span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;passed_rules&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;minimum_age&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;minimum_income&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;debt_to_income&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;employment_status&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span></code></pre></div><h3 id="3-easy-updates">3. Easy Updates</h3>
<p>Changing rules doesn&rsquo;t require retraining or prompt engineering:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># Add a new rule</span>
</span></span><span style="display:flex;"><span>LOAN_RULES<span style="color:#0550ae">.</span>append<span style="color:#1f2328">(</span>Rule<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    name<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;bankruptcy_check&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    description<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;No bankruptcy in the last 7 years&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    check<span style="color:#0550ae">=</span><span style="color:#cf222e">lambda</span> data<span style="color:#1f2328">:</span> RuleResult<span style="color:#0550ae">.</span>PASS <span style="color:#cf222e">if</span> <span style="color:#0550ae">not</span> data<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;recent_bankruptcy&#34;</span><span style="color:#1f2328">)</span> <span style="color:#cf222e">else</span> RuleResult<span style="color:#0550ae">.</span>FAIL<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    failure_reason<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Bankruptcy within last 7 years&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">))</span>
</span></span></code></pre></div><h3 id="4-explainability">4. Explainability</h3>
<p>The LLM can explain decisions using the structured rule output:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">explain_decision</span><span style="color:#1f2328">(</span>result<span style="color:#1f2328">:</span> <span style="color:#6639ba">dict</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Generate human-friendly explanation.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> result<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;eligible&#34;</span><span style="color:#1f2328">]:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#0a3069">&#34;You qualify because you meet all our criteria...&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        reasons <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>f<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;reason&#34;</span><span style="color:#1f2328">]</span> <span style="color:#cf222e">for</span> f <span style="color:#0550ae">in</span> result<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;failed_rules&#34;</span><span style="color:#1f2328">]]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Unfortunately, you don&#39;t qualify because: </span><span style="color:#0a3069">{</span><span style="color:#0a3069">&#39;, &#39;</span><span style="color:#0550ae">.</span>join<span style="color:#1f2328">(</span>reasons<span style="color:#1f2328">)</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span>
</span></span></code></pre></div><h2 id="other-symbolic-components">Other Symbolic Components</h2>
<h3 id="knowledge-graphs">Knowledge Graphs</h3>
<p>For factual queries, use a knowledge graph instead of relying on LLM memory:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">neo4j</span> <span style="color:#cf222e">import</span> GraphDatabase
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">query_product_compatibility</span><span style="color:#1f2328">(</span>product_a<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">,</span> product_b<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Check if two products are compatible using the knowledge graph.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    driver <span style="color:#0550ae">=</span> GraphDatabase<span style="color:#0550ae">.</span>driver<span style="color:#1f2328">(</span>uri<span style="color:#1f2328">,</span> auth<span style="color:#0550ae">=</span><span style="color:#1f2328">(</span>user<span style="color:#1f2328">,</span> password<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">with</span> driver<span style="color:#0550ae">.</span>session<span style="color:#1f2328">()</span> <span style="color:#cf222e">as</span> session<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        result <span style="color:#0550ae">=</span> session<span style="color:#0550ae">.</span>run<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">            MATCH (a:Product {name: $product_a})-[r:COMPATIBLE_WITH]-&gt;(b:Product {name: $product_b})
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">            RETURN r.notes as notes
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        &#34;&#34;&#34;</span><span style="color:#1f2328">,</span> product_a<span style="color:#0550ae">=</span>product_a<span style="color:#1f2328">,</span> product_b<span style="color:#0550ae">=</span>product_b<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record <span style="color:#0550ae">=</span> result<span style="color:#0550ae">.</span>single<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> record<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">return</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Yes, </span><span style="color:#0a3069">{</span>product_a<span style="color:#0a3069">}</span><span style="color:#0a3069"> is compatible with </span><span style="color:#0a3069">{</span>product_b<span style="color:#0a3069">}</span><span style="color:#0a3069">. </span><span style="color:#0a3069">{</span>record<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;notes&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">return</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;No verified compatibility between </span><span style="color:#0a3069">{</span>product_a<span style="color:#0a3069">}</span><span style="color:#0a3069"> and </span><span style="color:#0a3069">{</span>product_b<span style="color:#0a3069">}</span><span style="color:#0a3069">.&#34;</span>
</span></span></code></pre></div><h3 id="constraint-solvers">Constraint Solvers</h3>
<p>For optimization problems:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">ortools.linear_solver</span> <span style="color:#cf222e">import</span> pywraplp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">optimize_schedule</span><span style="color:#1f2328">(</span>tasks<span style="color:#1f2328">:</span> <span style="color:#6639ba">list</span><span style="color:#1f2328">[</span><span style="color:#6639ba">dict</span><span style="color:#1f2328">],</span> constraints<span style="color:#1f2328">:</span> <span style="color:#6639ba">dict</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Find optimal task schedule using constraint programming.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    solver <span style="color:#0550ae">=</span> pywraplp<span style="color:#0550ae">.</span>Solver<span style="color:#0550ae">.</span>CreateSolver<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;SCIP&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Define variables and constraints...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Solve...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> formatted_schedule
</span></span></code></pre></div><h3 id="calculators">Calculators</h3>
<p>Never let the LLM do math:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">calculate_compound_interest</span><span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    principal<span style="color:#1f2328">:</span> <span style="color:#6639ba">float</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    rate<span style="color:#1f2328">:</span> <span style="color:#6639ba">float</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    years<span style="color:#1f2328">:</span> <span style="color:#6639ba">int</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    compounds_per_year<span style="color:#1f2328">:</span> <span style="color:#6639ba">int</span> <span style="color:#0550ae">=</span> <span style="color:#0550ae">12</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Calculate compound interest with precision.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    amount <span style="color:#0550ae">=</span> principal <span style="color:#0550ae">*</span> <span style="color:#1f2328">(</span><span style="color:#0550ae">1</span> <span style="color:#0550ae">+</span> rate <span style="color:#0550ae">/</span> compounds_per_year<span style="color:#1f2328">)</span> <span style="color:#0550ae">**</span> <span style="color:#1f2328">(</span>compounds_per_year <span style="color:#0550ae">*</span> years<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    interest <span style="color:#0550ae">=</span> amount <span style="color:#0550ae">-</span> principal
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;After </span><span style="color:#0a3069">{</span>years<span style="color:#0a3069">}</span><span style="color:#0a3069"> years: $</span><span style="color:#0a3069">{</span>amount<span style="color:#0a3069">:</span><span style="color:#0a3069">,.2f</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> ($</span><span style="color:#0a3069">{</span>interest<span style="color:#0a3069">:</span><span style="color:#0a3069">,.2f</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> interest earned)&#34;</span>
</span></span></code></pre></div><h2 id="design-patterns">Design Patterns</h2>
<h3 id="pattern-1-llm-as-router">Pattern 1: LLM as Router</h3>
<p>The LLM decides which symbolic system to call:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># LLM sees: &#34;What&#39;s 15% of 847?&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># LLM decides: Call calculator tool</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Calculator returns: &#34;127.05&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># LLM responds: &#34;15% of 847 is 127.05&#34;</span>
</span></span></code></pre></div><h3 id="pattern-2-symbolic-pre-processing">Pattern 2: Symbolic Pre-processing</h3>
<p>Run rules before the LLM sees the query:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">pre_check</span><span style="color:#1f2328">(</span>user_data<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Pre-check eligibility before expensive LLM call.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    quick_result <span style="color:#0550ae">=</span> engine<span style="color:#0550ae">.</span>quick_check<span style="color:#1f2328">(</span>user_data<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> quick_result <span style="color:#0550ae">==</span> <span style="color:#0a3069">&#34;definitely_ineligible&#34;</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#0a3069">&#34;Based on the information provided, you don&#39;t meet our minimum requirements.&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#cf222e">None</span>  <span style="color:#57606a"># Proceed to LLM</span>
</span></span></code></pre></div><h3 id="pattern-3-symbolic-post-validation">Pattern 3: Symbolic Post-validation</h3>
<p>Validate LLM outputs with rules:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">validate_response</span><span style="color:#1f2328">(</span>llm_output<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">,</span> context<span style="color:#1f2328">:</span> <span style="color:#6639ba">dict</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Ensure LLM didn&#39;t hallucinate numbers.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    extracted_numbers <span style="color:#0550ae">=</span> extract_numbers<span style="color:#1f2328">(</span>llm_output<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">for</span> num <span style="color:#0550ae">in</span> extracted_numbers<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> <span style="color:#0550ae">not</span> validator<span style="color:#0550ae">.</span>is_valid<span style="color:#1f2328">(</span>num<span style="color:#1f2328">,</span> context<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">return</span> regenerate_with_correction<span style="color:#1f2328">(</span>llm_output<span style="color:#1f2328">,</span> num<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> llm_output
</span></span></code></pre></div><hr>
<h2 id="try-it-yourself">Try It Yourself</h2>
<p>Copy this prompt into your AI coding agent to build this project:</p>
<pre tabindex="0"><code>Build a hybrid AI agent for loan eligibility using LLM + symbolic reasoning:
1. A rule engine with eligibility rules (age, income, debt-to-income, credit)
2. Tool functions that expose the rule engine to the LLM
3. An OpenAI agent that collects user info conversationally
4. The agent must ALWAYS use tools for decisions, never guess

Define rules using dataclasses with name, description, check function, and
failure reason. The rule engine should return structured results showing
which rules passed/failed. Test with a sample conversation collecting
applicant data and checking eligibility.
</code></pre>
    <hr class="footer-separator" />
<div class="tags">
    
    
    <ul class="flat">
        
        
        <li class="tag-li"><a href="/tags/ai">AI</a>
        </li>
        
        
        <li class="tag-li"><a href="/tags/symbolic-ai">Symbolic AI</a>
        </li>
        
        
        <li class="tag-li"><a href="/tags/hybrid-systems">Hybrid Systems</a>
        </li>
        
        
        <li class="tag-li"><a href="/tags/python">Python</a>
        </li>
        
        
        <li class="tag-li"><a href="/tags/tutorial">Tutorial</a>
        </li>
        
    </ul>
    
    
</div>



<div class="back">
    <a href="https://notes.muthu.co/"><span aria-hidden="true">← Back</span></a>
</div>


<div class="back">
    
</div>

</div>

	</div>
	

	<div class="footer wrapper">
	<nav class="nav">
		<div>&copy 2026   Muthukrishnan</div>
		<div>Contact: muthukrishnan.t [at] hotmail [dot] com</div>
	</nav>
</div><script>feather.replace()</script>

<script type="module">
	import mermaid from "https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs";

	const getMermaidTheme = () => {
		const savedScheme = localStorage.getItem('scheme');
		if (savedScheme) {
			return savedScheme === 'dark' ? 'dark' : 'default';
		}
		return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'default';
	};

	mermaid.initialize({
		startOnLoad: true,
		theme: getMermaidTheme(),
		handDrawn: true
	});

	const applyTheme = () => {
		const newTheme = getMermaidTheme();
		mermaid.initialize({
			startOnLoad: true,
			theme: newTheme,
			handDrawn: true
		});
	};

	window.addEventListener('storage', (event) => {
		if (event.key === 'scheme') {
			applyTheme();
		}
	});

	window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme);
</script>


	
</body>

</html>
