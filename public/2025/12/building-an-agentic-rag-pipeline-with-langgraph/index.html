<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Building an Agentic RAG Pipeline with LangGraph - Engineering Notes</title><link rel="icon" type="image/jpeg" href=/avatar.jpeg />
	<link rel="apple-touch-icon" href=/avatar.jpeg /><meta name="viewport" content="width=device-width, initial-scale=1">
	
  <meta itemprop="name" content="Building an Agentic RAG Pipeline with LangGraph">
  <meta itemprop="description" content="Move beyond naive RAG with an agentic approach that uses LLMs to decide what to retrieve, when to retry, and how to synthesize answers.">
  <meta itemprop="datePublished" content="2025-12-24T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-12-24T00:00:00+00:00">
  <meta itemprop="wordCount" content="1202">
  <meta itemprop="keywords" content="Ai,RAG,Langgraph,Python,Tutorial"><meta property="og:url" content="https://notes.muthu.co/2025/12/building-an-agentic-rag-pipeline-with-langgraph/">
  <meta property="og:site_name" content="Engineering Notes">
  <meta property="og:title" content="Building an Agentic RAG Pipeline with LangGraph">
  <meta property="og:description" content="Move beyond naive RAG with an agentic approach that uses LLMs to decide what to retrieve, when to retry, and how to synthesize answers.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-12-24T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-24T00:00:00+00:00">
    <meta property="article:tag" content="Ai">
    <meta property="article:tag" content="RAG">
    <meta property="article:tag" content="Langgraph">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Tutorial">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Building an Agentic RAG Pipeline with LangGraph">
  <meta name="twitter:description" content="Move beyond naive RAG with an agentic approach that uses LLMs to decide what to retrieve, when to retry, and how to synthesize answers.">
<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" media="screen" href="https://notes.muthu.co/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://notes.muthu.co/css/main.css" />
	<link rel="stylesheet" type="text/css" media="print" href="https://notes.muthu.co/css/print.css" />

	<link id="dark-scheme" rel="stylesheet" type="text/css" href="https://notes.muthu.co/css/dark.css" /><script src="https://notes.muthu.co/js/feather.min.js"></script>
	
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" crossorigin="anonymous">
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js" crossorigin="anonymous"></script>
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js" crossorigin="anonymous"
		onload="renderMathInElement(document.body, {delimiters:[{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false}]});"></script>
	<script src="https://notes.muthu.co/js/main.js"></script>
</head>


<body>


	
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://notes.muthu.co/">
				<img src="/avatar.jpeg" alt="Engineering Notes" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://notes.muthu.co/">Engineering Notes</a></h1>
	<div class="site-description"><p>Thoughts and Ideas on AI by Muthukrishnan</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/muthuspark/" title="Github"><i data-feather="github"></i></a></li><li><a href="https://linkedin.com/in/krimuthu/" title="LinkedIn"><i data-feather="linkedin"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/ai-agents">AI Agents</a>
			</li>
			
			<li>
				<a href="/engineering-manager">Engineering Manager</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/resume">Resume</a>
			</li>
			
			<li>
				<a href="/tags">Tags &amp; Stats</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
    <div class="post-header">
    <div class="matter">
        <h1 class="title">Building an Agentic RAG Pipeline with LangGraph</h1>
        
        <div class="date">
            <span class="day">24</span>
            <span class="rest">Dec 2025</span>
        </div>
        
    </div>
</div>


    
    
    <p>Traditional RAG (Retrieval-Augmented Generation) follows a simple pattern: embed the query, find similar documents, generate an answer. But this &ldquo;naive RAG&rdquo; approach breaks down when queries are complex, ambiguous, or require information from multiple sources.</p>
<p>Agentic RAG solves this by letting the LLM make decisions about retrieval. Instead of a fixed pipeline, the LLM can:</p>
<ul>
<li>Decompose complex queries into sub-queries</li>
<li>Decide if retrieved documents are sufficient</li>
<li>Reformulate queries when initial retrieval fails</li>
<li>Synthesize information from multiple retrieval rounds</li>
</ul>
<p>In this article, we&rsquo;ll build an Agentic RAG system using LangGraph.</p>
<h2 id="the-problem-with-naive-rag">The Problem with Naive RAG</h2>
<pre class="mermaid">graph LR
    A[Query] --&gt; B[Embed]
    B --&gt; C[Retrieve]
    C --&gt; D[Generate]
    D --&gt; E[Answer]
  </pre>

<p>Naive RAG has a fixed flow. If retrieval returns irrelevant documents, the generator hallucinates. If the query is ambiguous, retrieval fails silently. There&rsquo;s no feedback loop.</p>
<h2 id="the-agentic-rag-solution">The Agentic RAG Solution</h2>
<pre class="mermaid">graph TD
    A[Query] --&gt; B[Analyze Query]
    B --&gt; C[Retrieve]
    C --&gt; D{Relevant?}
    D --&gt;|No| E[Rewrite Query]
    E --&gt; C
    D --&gt;|Yes| F[Generate]
    F --&gt; G[Answer]
  </pre>

<p>Agentic RAG adds decision points. The LLM evaluates retrieval quality and can loop back to try different queries.</p>
<h2 id="building-the-pipeline">Building the Pipeline</h2>
<h3 id="step-1-define-the-state">Step 1: Define the State</h3>
<p>LangGraph requires an explicit state schema. For Agentic RAG, we track the query, search attempts, retrieved documents, and the final answer.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">typing</span> <span style="color:#cf222e">import</span> TypedDict<span style="color:#1f2328">,</span> Annotated<span style="color:#1f2328">,</span> Literal
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">langgraph.graph</span> <span style="color:#cf222e">import</span> StateGraph<span style="color:#1f2328">,</span> END
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">operator</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">class</span> <span style="color:#1f2328">RAGState</span><span style="color:#1f2328">(</span>TypedDict<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    query<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span>                                          <span style="color:#57606a"># Original user query</span>
</span></span><span style="display:flex;"><span>    search_queries<span style="color:#1f2328">:</span> Annotated<span style="color:#1f2328">[</span><span style="color:#6639ba">list</span><span style="color:#1f2328">[</span><span style="color:#6639ba">str</span><span style="color:#1f2328">],</span> operator<span style="color:#0550ae">.</span>add<span style="color:#1f2328">]</span>  <span style="color:#57606a"># Generated search queries</span>
</span></span><span style="display:flex;"><span>    documents<span style="color:#1f2328">:</span> Annotated<span style="color:#1f2328">[</span><span style="color:#6639ba">list</span><span style="color:#1f2328">[</span><span style="color:#6639ba">dict</span><span style="color:#1f2328">],</span> operator<span style="color:#0550ae">.</span>add<span style="color:#1f2328">]</span>      <span style="color:#57606a"># Retrieved documents</span>
</span></span><span style="display:flex;"><span>    answer<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span>                                         <span style="color:#57606a"># Final generated answer</span>
</span></span><span style="display:flex;"><span>    needs_more_info<span style="color:#1f2328">:</span> <span style="color:#6639ba">bool</span>                               <span style="color:#57606a"># Flag for retrieval loop</span>
</span></span><span style="display:flex;"><span>    iteration<span style="color:#1f2328">:</span> <span style="color:#6639ba">int</span>                                      <span style="color:#57606a"># Prevent infinite loops</span>
</span></span></code></pre></div><p>The <code>Annotated</code> type with <code>operator.add</code> tells LangGraph to accumulate values instead of replacing them.</p>
<h3 id="step-2-query-analyzer">Step 2: Query Analyzer</h3>
<p>The first agent analyzes the query and decides how to search. For complex queries, it might generate multiple sub-queries.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">langchain_openai</span> <span style="color:#cf222e">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>llm <span style="color:#0550ae">=</span> ChatOpenAI<span style="color:#1f2328">(</span>model<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;gpt-4o-mini&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">query_analyzer</span><span style="color:#1f2328">(</span>state<span style="color:#1f2328">:</span> RAGState<span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">dict</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Analyze and decompose the user query.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    query <span style="color:#0550ae">=</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;query&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    messages <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;user&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;&#34;&#34;Analyze this query and generate 1-3 search queries that would help answer it. Return only the queries, one per line.
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">Query: </span><span style="color:#0a3069">{</span>query<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;&#34;&#34;</span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#0550ae">=</span> llm<span style="color:#0550ae">.</span>invoke<span style="color:#1f2328">(</span>messages<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    search_queries <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>q<span style="color:#0550ae">.</span>strip<span style="color:#1f2328">()</span> <span style="color:#cf222e">for</span> q <span style="color:#0550ae">in</span> response<span style="color:#0550ae">.</span>content<span style="color:#0550ae">.</span>split<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span> <span style="color:#cf222e">if</span> q<span style="color:#0550ae">.</span>strip<span style="color:#1f2328">()]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;search_queries&#34;</span><span style="color:#1f2328">:</span> search_queries<span style="color:#1f2328">}</span>
</span></span></code></pre></div><h3 id="step-3-retriever">Step 3: Retriever</h3>
<p>The retriever searches your vector store. Here&rsquo;s an example using ChromaDB:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">chromadb</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">sentence_transformers</span> <span style="color:#cf222e">import</span> SentenceTransformer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Initialize (in production, load existing collection)</span>
</span></span><span style="display:flex;"><span>client <span style="color:#0550ae">=</span> chromadb<span style="color:#0550ae">.</span>Client<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>collection <span style="color:#0550ae">=</span> client<span style="color:#0550ae">.</span>get_or_create_collection<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;documents&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>embedder <span style="color:#0550ae">=</span> SentenceTransformer<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;all-MiniLM-L6-v2&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">retriever</span><span style="color:#1f2328">(</span>state<span style="color:#1f2328">:</span> RAGState<span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">dict</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Retrieve documents for each search query.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    search_queries <span style="color:#0550ae">=</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;search_queries&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    all_docs <span style="color:#0550ae">=</span> <span style="color:#1f2328">[]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">for</span> query <span style="color:#0550ae">in</span> search_queries<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Embed and search</span>
</span></span><span style="display:flex;"><span>        embedding <span style="color:#0550ae">=</span> embedder<span style="color:#0550ae">.</span>encode<span style="color:#1f2328">(</span>query<span style="color:#1f2328">)</span><span style="color:#0550ae">.</span>tolist<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>        results <span style="color:#0550ae">=</span> collection<span style="color:#0550ae">.</span>query<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            query_embeddings<span style="color:#0550ae">=</span><span style="color:#1f2328">[</span>embedding<span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>            n_results<span style="color:#0550ae">=</span><span style="color:#0550ae">3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">for</span> i<span style="color:#1f2328">,</span> doc <span style="color:#0550ae">in</span> <span style="color:#6639ba">enumerate</span><span style="color:#1f2328">(</span>results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;documents&#34;</span><span style="color:#1f2328">][</span><span style="color:#0550ae">0</span><span style="color:#1f2328">]):</span>
</span></span><span style="display:flex;"><span>            all_docs<span style="color:#0550ae">.</span>append<span style="color:#1f2328">({</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> doc<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;metadata&#34;</span><span style="color:#1f2328">:</span> results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;metadatas&#34;</span><span style="color:#1f2328">][</span><span style="color:#0550ae">0</span><span style="color:#1f2328">][</span>i<span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;query&#34;</span><span style="color:#1f2328">:</span> query
</span></span><span style="display:flex;"><span>            <span style="color:#1f2328">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Deduplicate by content</span>
</span></span><span style="display:flex;"><span>    seen <span style="color:#0550ae">=</span> <span style="color:#6639ba">set</span><span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    unique_docs <span style="color:#0550ae">=</span> <span style="color:#1f2328">[]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">for</span> doc <span style="color:#0550ae">in</span> all_docs<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> doc<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">not</span> <span style="color:#0550ae">in</span> seen<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            seen<span style="color:#0550ae">.</span>add<span style="color:#1f2328">(</span>doc<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">])</span>
</span></span><span style="display:flex;"><span>            unique_docs<span style="color:#0550ae">.</span>append<span style="color:#1f2328">(</span>doc<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;documents&#34;</span><span style="color:#1f2328">:</span> unique_docs<span style="color:#1f2328">}</span>
</span></span></code></pre></div><h3 id="step-4-relevance-checker">Step 4: Relevance Checker</h3>
<p>This is the key agentic component. The LLM evaluates whether retrieved documents can answer the query.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">relevance_checker</span><span style="color:#1f2328">(</span>state<span style="color:#1f2328">:</span> RAGState<span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">dict</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Check if retrieved documents are sufficient.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    docs <span style="color:#0550ae">=</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;documents&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    query <span style="color:#0550ae">=</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;query&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> <span style="color:#0550ae">not</span> docs<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;needs_more_info&#34;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">True</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;iteration&#34;</span><span style="color:#1f2328">:</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;iteration&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">+</span> <span style="color:#0550ae">1</span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Ask LLM to evaluate relevance</span>
</span></span><span style="display:flex;"><span>    doc_summaries <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">&#34;</span><span style="color:#0550ae">.</span>join<span style="color:#1f2328">([</span>d<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">][:</span><span style="color:#0550ae">200</span><span style="color:#1f2328">]</span> <span style="color:#cf222e">for</span> d <span style="color:#0550ae">in</span> docs<span style="color:#1f2328">[:</span><span style="color:#0550ae">5</span><span style="color:#1f2328">]])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    messages <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;user&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;&#34;&#34;Given the query and retrieved documents, can you answer the query?
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">Query: </span><span style="color:#0a3069">{</span>query<span style="color:#0a3069">}</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">Documents:
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069"></span><span style="color:#0a3069">{</span>doc_summaries<span style="color:#0a3069">}</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">Reply with only YES or NO.&#34;&#34;&#34;</span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#0550ae">=</span> llm<span style="color:#0550ae">.</span>invoke<span style="color:#1f2328">(</span>messages<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    needs_more <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;NO&#34;</span> <span style="color:#0550ae">in</span> response<span style="color:#0550ae">.</span>content<span style="color:#0550ae">.</span>upper<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Prevent infinite loops</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;iteration&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">&gt;=</span> <span style="color:#0550ae">2</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        needs_more <span style="color:#0550ae">=</span> <span style="color:#cf222e">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;needs_more_info&#34;</span><span style="color:#1f2328">:</span> needs_more<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;iteration&#34;</span><span style="color:#1f2328">:</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;iteration&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">+</span> <span style="color:#0550ae">1</span><span style="color:#1f2328">}</span>
</span></span></code></pre></div><h3 id="step-5-query-rewriter">Step 5: Query Rewriter</h3>
<p>When retrieval fails, the query rewriter generates alternative queries.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">query_rewriter</span><span style="color:#1f2328">(</span>state<span style="color:#1f2328">:</span> RAGState<span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">dict</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Rewrite the query for better retrieval.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    query <span style="color:#0550ae">=</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;query&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    previous_queries <span style="color:#0550ae">=</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;search_queries&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    messages <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;user&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;&#34;&#34;The following search queries didn&#39;t find relevant results:
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069"></span><span style="color:#0a3069">{</span>previous_queries<span style="color:#0a3069">}</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">Original question: </span><span style="color:#0a3069">{</span>query<span style="color:#0a3069">}</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">Generate 2 alternative search queries that might work better.
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">Use different keywords, synonyms, or rephrasings.
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">Return only the queries, one per line.&#34;&#34;&#34;</span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#0550ae">=</span> llm<span style="color:#0550ae">.</span>invoke<span style="color:#1f2328">(</span>messages<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    new_queries <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>q<span style="color:#0550ae">.</span>strip<span style="color:#1f2328">()</span> <span style="color:#cf222e">for</span> q <span style="color:#0550ae">in</span> response<span style="color:#0550ae">.</span>content<span style="color:#0550ae">.</span>split<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span> <span style="color:#cf222e">if</span> q<span style="color:#0550ae">.</span>strip<span style="color:#1f2328">()]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;search_queries&#34;</span><span style="color:#1f2328">:</span> new_queries<span style="color:#1f2328">}</span>
</span></span></code></pre></div><h3 id="step-6-generator">Step 6: Generator</h3>
<p>Finally, the generator synthesizes an answer from retrieved documents.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">generator</span><span style="color:#1f2328">(</span>state<span style="color:#1f2328">:</span> RAGState<span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">dict</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Generate answer from retrieved documents.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    docs <span style="color:#0550ae">=</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;documents&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    query <span style="color:#0550ae">=</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;query&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> <span style="color:#0550ae">not</span> docs<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;answer&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;I couldn&#39;t find relevant information to answer your question.&#34;</span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    context <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n\n</span><span style="color:#0a3069">&#34;</span><span style="color:#0550ae">.</span>join<span style="color:#1f2328">([</span>d<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">]</span> <span style="color:#cf222e">for</span> d <span style="color:#0550ae">in</span> docs<span style="color:#1f2328">[:</span><span style="color:#0550ae">5</span><span style="color:#1f2328">]])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    messages <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;user&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;&#34;&#34;Answer the question based on the provided context.
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">If the context doesn&#39;t contain the answer, say so.
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">Context:
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069"></span><span style="color:#0a3069">{</span>context<span style="color:#0a3069">}</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">Question: </span><span style="color:#0a3069">{</span>query<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;&#34;&#34;</span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#0550ae">=</span> llm<span style="color:#0550ae">.</span>invoke<span style="color:#1f2328">(</span>messages<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;answer&#34;</span><span style="color:#1f2328">:</span> response<span style="color:#0550ae">.</span>content<span style="color:#1f2328">}</span>
</span></span></code></pre></div><h3 id="step-7-build-the-graph">Step 7: Build the Graph</h3>
<p>Now wire everything together with conditional edges:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">should_continue</span><span style="color:#1f2328">(</span>state<span style="color:#1f2328">:</span> RAGState<span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> Literal<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;rewrite&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;generate&#34;</span><span style="color:#1f2328">]:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Route based on relevance check.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;needs_more_info&#34;</span><span style="color:#1f2328">]:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#0a3069">&#34;rewrite&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#0a3069">&#34;generate&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">create_agentic_rag</span><span style="color:#1f2328">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Build the Agentic RAG graph.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    workflow <span style="color:#0550ae">=</span> StateGraph<span style="color:#1f2328">(</span>RAGState<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Add all nodes</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#0550ae">.</span>add_node<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;analyze&#34;</span><span style="color:#1f2328">,</span> query_analyzer<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#0550ae">.</span>add_node<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;retrieve&#34;</span><span style="color:#1f2328">,</span> retriever<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#0550ae">.</span>add_node<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;check&#34;</span><span style="color:#1f2328">,</span> relevance_checker<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#0550ae">.</span>add_node<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;rewrite&#34;</span><span style="color:#1f2328">,</span> query_rewriter<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#0550ae">.</span>add_node<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;generate&#34;</span><span style="color:#1f2328">,</span> generator<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Define the flow</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#0550ae">.</span>set_entry_point<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;analyze&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#0550ae">.</span>add_edge<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;analyze&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;retrieve&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#0550ae">.</span>add_edge<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;retrieve&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;check&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Conditional branching</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#0550ae">.</span>add_conditional_edges<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;check&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        should_continue<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;rewrite&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;rewrite&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;generate&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;generate&#34;</span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Loop back from rewrite to retrieve</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#0550ae">.</span>add_edge<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;rewrite&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;retrieve&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#0550ae">.</span>add_edge<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;generate&#34;</span><span style="color:#1f2328">,</span> END<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> workflow<span style="color:#0550ae">.</span>compile<span style="color:#1f2328">()</span>
</span></span></code></pre></div><h2 id="running-the-pipeline">Running the Pipeline</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>graph <span style="color:#0550ae">=</span> create_agentic_rag<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>result <span style="color:#0550ae">=</span> graph<span style="color:#0550ae">.</span>invoke<span style="color:#1f2328">({</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;query&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;How does transformer attention work?&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;search_queries&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;documents&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;answer&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;needs_more_info&#34;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">False</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;iteration&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0550ae">0</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Iterations: </span><span style="color:#0a3069">{</span>result<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;iteration&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Documents used: </span><span style="color:#0a3069">{</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>result<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;documents&#39;</span><span style="color:#1f2328">])</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Answer: </span><span style="color:#0a3069">{</span>result<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;answer&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><h2 id="key-design-decisions">Key Design Decisions</h2>
<h3 id="1-iteration-limits">1. Iteration Limits</h3>
<p>Always cap the number of retrieval loops to prevent runaway costs:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">if</span> state<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;iteration&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">&gt;=</span> <span style="color:#0550ae">2</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    needs_more <span style="color:#0550ae">=</span> <span style="color:#cf222e">False</span>  <span style="color:#57606a"># Force generation after 2 attempts</span>
</span></span></code></pre></div><h3 id="2-document-deduplication">2. Document Deduplication</h3>
<p>Multiple search queries may return overlapping results. Deduplicate before generation to avoid redundancy.</p>
<h3 id="3-graceful-degradation">3. Graceful Degradation</h3>
<p>If retrieval completely fails, generate an honest &ldquo;I don&rsquo;t know&rdquo; rather than hallucinating.</p>
<h2 id="comparison-naive-vs-agentic-rag">Comparison: Naive vs Agentic RAG</h2>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Naive RAG</th>
          <th>Agentic RAG</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Query handling</td>
          <td>Single embedding</td>
          <td>Multi-query decomposition</td>
      </tr>
      <tr>
          <td>Retrieval failures</td>
          <td>Silent failure</td>
          <td>Retry with reformulation</td>
      </tr>
      <tr>
          <td>Complex queries</td>
          <td>Poor performance</td>
          <td>Handles well</td>
      </tr>
      <tr>
          <td>Cost</td>
          <td>Lower</td>
          <td>Higher (more LLM calls)</td>
      </tr>
      <tr>
          <td>Latency</td>
          <td>Faster</td>
          <td>Slower (multiple rounds)</td>
      </tr>
  </tbody>
</table>
<h2 id="when-to-use-agentic-rag">When to Use Agentic RAG</h2>
<p>Use Agentic RAG when:</p>
<ul>
<li>Queries are complex or multi-part</li>
<li>Your document corpus is large and diverse</li>
<li>Retrieval quality is inconsistent</li>
<li>Users expect high-quality, sourced answers</li>
</ul>
<p>Stick with naive RAG when:</p>
<ul>
<li>Queries are simple and direct</li>
<li>Latency is critical</li>
<li>Cost per query must be minimized</li>
</ul>
<h2 id="whats-next">What&rsquo;s Next</h2>
<p>This basic Agentic RAG can be extended with:</p>
<ul>
<li><strong>Parallel retrieval:</strong> Search multiple sources simultaneously</li>
<li><strong>Source ranking:</strong> Let the LLM rank and filter retrieved documents</li>
<li><strong>Citation generation:</strong> Include source references in answers</li>
<li><strong>Streaming:</strong> Return partial answers as retrieval progresses</li>
</ul>
<p>Agentic RAG represents the evolution from simple retrieval to intelligent information synthesis. The LLM becomes an active participant in the search process, not just a passive consumer of retrieved documents.</p>
<hr>
<h2 id="try-it-yourself">Try It Yourself</h2>
<p>Copy this prompt into your AI coding agent to build this project:</p>
<pre tabindex="0"><code>Build an Agentic RAG pipeline using LangGraph with these components:
1. Query analyzer that decomposes complex queries into sub-queries
2. Retriever that searches a ChromaDB vector store
3. Relevance checker that evaluates if retrieved docs can answer the query
4. Query rewriter that reformulates queries when retrieval fails
5. Generator that synthesizes the final answer

Use StateGraph with conditional edges for the retry loop. Include an iteration
limit to prevent infinite loops. Test with sample documents about a technical
topic and show how the agent handles queries that need multiple retrieval attempts.
</code></pre>
    <div class="jovis-ad">
    <div class="jovis-ad-badge"> Intelligence at Every Action</div>
    <h3 class="jovis-ad-headline">AI Native<br><span class="jovis-ad-cyan">Project Management</span></h3>
    <p class="jovis-ad-description">Stop using tools that bolt on AI as an afterthought. Jovis is built AI-first  smart routing, proactive monitoring, and intelligent workflows from the ground up.</p>
    <div class="jovis-ad-buttons">
        <a class="jovis-ad-cta" href="https://jovis.ai?utm_source=blog&utm_medium=post_footer">Get early access </a>
        <a class="jovis-ad-secondary" href="https://jovis.ai?utm_source=blog&utm_medium=post_footer&utm_content=how_it_works">See how it works</a>
    </div>
</div>

    <hr class="footer-separator" />
<div class="tags">
    
    
    <ul class="flat">
        
        
        <li class="tag-li"><a href="/tags/ai">AI</a>
        </li>
        
        
        <li class="tag-li"><a href="/tags/rag">RAG</a>
        </li>
        
        
        <li class="tag-li"><a href="/tags/langgraph">LangGraph</a>
        </li>
        
        
        <li class="tag-li"><a href="/tags/python">Python</a>
        </li>
        
        
        <li class="tag-li"><a href="/tags/tutorial">Tutorial</a>
        </li>
        
    </ul>
    
    
</div>



<div class="back">
    <a href="https://notes.muthu.co/"><span aria-hidden="true"> Back</span></a>
</div>


<div class="back">
    
</div>

</div>

	</div>
	

	<div class="grid-overlay visible" id="grid-overlay">
	<div class="grid-overlay-baseline"></div>
	<div class="grid-overlay-columns">
		<div></div><div></div><div></div><div></div>
		<div></div><div></div><div></div><div></div>
		<div></div><div></div><div></div><div></div>
	</div>
</div>


<div class="footer wrapper">
	<nav class="nav">
		<div>&copy 2025   Muthukrishnan</div>
		<div>Contact: muthukrishnan.t [at] hotmail [dot] com</div>
	</nav>
</div><script>feather.replace()</script>

<script type="module">
	import mermaid from "https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs";

	mermaid.initialize({
		startOnLoad: true,
		theme: 'default',
		handDrawn: true
	});

	const applyTheme = () => {
		const newTheme = 'default';
		mermaid.initialize({
			startOnLoad: true,
			theme: newTheme,
			handDrawn: true
		});
	};

	window.addEventListener('storage', (event) => {
		if (event.key === 'scheme') {
			applyTheme();
		}
	});

	window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme);
</script>


	
</body>

</html>
